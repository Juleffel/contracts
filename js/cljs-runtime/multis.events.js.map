{"version":3,"sources":["multis/events.cljs"],"mappings":"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","names":["multis.events/trace","b","cljs.core.println.cljs$core$IFn$_invoke$arity$variadic","multis.events/interceptors","re-frame.core/trim-v","re_frame.core.reg_event_fx.cljs$core$IFn$_invoke$arity$2","multis.db/initial-db","_","re_frame.core.reg_event_fx.cljs$core$IFn$_invoke$arity$3","p__54272","p__54273","map__54274","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-map","db","cljs.core.get.cljs$core$IFn$_invoke$arity$2","vec__54275","cljs.core.nth.cljs$core$IFn$_invoke$arity$3","path","addresses","p1__54271#","cljs.core.update_in.cljs$core$IFn$_invoke$arity$3","cljs.core.reduce.cljs$core$IFn$_invoke$arity$3","accounts","address","cljs.core.assoc.cljs$core$IFn$_invoke$arity$3","cljs.core.keyword.cljs$core$IFn$_invoke$arity$1","cljs.core/first","multis.events/no-balance-addresses","no-balance-accounts","p1__54279#","cljs.core.filter.cljs$core$IFn$_invoke$arity$2","cljs.core/not","cljs.core.map.cljs$core$IFn$_invoke$arity$2","multis.utils/reg-trigger-raw","temp__5735__auto__","multis.events/account-addresses","key","cljs.core/vals","p__54280","map__54281","p__54283","vec__54284","iter__4582__auto__","s__54288","cljs.core/LazySeq","cljs.core/seq","cljs.core/chunked-seq?","c__4580__auto__","size__4581__auto__","cljs.core/count","b__54290","cljs.core/chunk-buffer","i__54289","cljs.core._nth.cljs$core$IFn$_invoke$arity$2","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__54287","cljs.core/chunk-rest","cljs.core/cons","cljs.core/rest","p__54291","p__54292","map__54293","vec__54294","cljs.core/assoc-in","re_frame.core.reg_event_db.cljs$core$IFn$_invoke$arity$3","p__54298","vec__54299","amount","multis.cljs-web3/from-wei","p__54302","p__54303","map__54304","vec__54305","contract-name","map__54309","name","cljs.core.get_in.cljs$core$IFn$_invoke$arity$2","p__54311","p__54312","map__54313","vec__54314","map__54318","p__54320","p__54321","map__54322","vec__54323","contract-instance","p__54327","vec__54328","params","p__54331","vec__54332","res","cljs.core.js__GT_clj.cljs$core$IFn$_invoke$arity$1","p__54335","vec__54336","p__54339","vec__54340","p__54343","vec__54344","resp","cljs.core.update.cljs$core$IFn$_invoke$arity$4","cljs.core/conj","G__54347","G__54348","re-frame.core/reg-sub","G__54349","G__54350","G__54351","G__54352","p__54353","vec__54354","doc","re_frame.core.reg_event_db.cljs$core$IFn$_invoke$arity$2","p__54357","vec__54358","value","cljs.core.into.cljs$core$IFn$_invoke$arity$2","p__54361","vec__54362","f","cljs.core.update_in.cljs$core$IFn$_invoke$arity$4","cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2","p__54365","map__54366","map__54368","selected-user-account","selected-recipient-account","stream-amount","stream-duration","now","js/Date","start-time","stop-time","cljs.core.dissoc.cljs$core$IFn$_invoke$arity$variadic","p__54370","vec__54371","error","p__54374","vec__54375","title","cljs.core/chunk-first"],"sourcesContent":["(ns multis.events\r\n  (:require\r\n   [re-frame.core :as rf]\r\n   \r\n   [multis.cljs-web3 :as cljs-web3]\r\n   [multis.web3-events]\r\n   [multis.utils :as utils]\r\n\r\n   [multis.db :refer [initial-db]]))\r\n\r\n(defn trace [b]\r\n  (println b)\r\n  b)\r\n\r\n(def interceptors [rf/trim-v])\r\n\r\n(rf/reg-event-fx\r\n :app/initialise-db\r\n (fn []\r\n   {:db initial-db\r\n    :dispatch-n [[:app/load-user-accounts]\r\n                 [:app/load-db-contract :sablier]\r\n                 [:app/load-db-contract :token]]}))\r\n\r\n;; Accounts / Balances\r\n(rf/reg-event-fx\r\n :app/load-user-accounts\r\n (fn [_ _]\r\n   {:dispatch-chain [[[:blockchain/load-accounts]\r\n                      [:app/accounts-loaded [:user-accounts]]]]}))\r\n\r\n(rf/reg-event-fx\r\n :app/accounts-loaded\r\n [rf/trim-v]\r\n (fn [{:keys [:db]} [path addresses]]\r\n   {:db (update-in db path\r\n                   #(reduce\r\n                     (fn [accounts address]\r\n                       (assoc accounts (keyword address) {:address address}))\r\n                     % addresses))\r\n    :dispatch-n [(when addresses [:form-set-value [:selected-user-account] (first addresses)])]}))\r\n\r\n(defn no-balance-addresses\r\n  [accounts]\r\n  (let [no-balance-accounts (filter #(and (not (:amount %)) (not (:balance-fetched %))) accounts)\r\n        addresses (map :address no-balance-accounts)]\r\n    addresses))\r\n\r\n(utils/reg-trigger-raw\r\n :app/fill-balances\r\n [[:user-accounts]]\r\n (fn [accounts]\r\n   (when-let [addresses (no-balance-addresses accounts)]\r\n     [:app/get-balances :user-accounts addresses])))\r\n\r\n(utils/reg-trigger-raw\r\n :app/fill-balances\r\n [[:recipient-accounts]]\r\n (fn [accounts]\r\n   (when-let [addresses (no-balance-addresses accounts)]\r\n     [:app/get-balances :recipient-accounts addresses])))\r\n\r\n(defn account-addresses\r\n  [db key]\r\n  (->> db\r\n       key\r\n       vals\r\n       (map :address)))\r\n\r\n(rf/reg-event-fx\r\n :app/refresh-balances\r\n [rf/trim-v]\r\n (fn [{:keys [:db]} _]\r\n   {:dispatch-n [[:app/get-balances :user-accounts (account-addresses :user-accounts db)]\r\n                 [:app/get-balances :recipient-accounts (account-addresses :recipient-accounts db)]]}))\r\n\r\n(rf/reg-event-fx\r\n :app/get-balances\r\n [rf/trim-v]\r\n (fn [_ [key addresses]]\r\n   {:dispatch-n (for [address addresses]\r\n                  [:app/get-balance key address])}))\r\n\r\n(rf/reg-event-fx\r\n :app/get-balance\r\n [rf/trim-v]\r\n (fn [{:keys [:db]} [key address]]\r\n   {:db (assoc-in db [key (keyword address) :balance-fetched] true)\r\n    :dispatch-chain [[[:blockchain/get-balance address]\r\n                      [:app/balance-loaded key address]]]}))\r\n\r\n(rf/reg-event-db\r\n :app/balance-loaded\r\n [rf/trim-v]\r\n (fn [db [key address amount]]\r\n   (-> db\r\n       (assoc-in [key (keyword address) :amount] amount)\r\n       (assoc-in [key (keyword address) :eth] (cljs-web3/from-wei amount \"ether\")))))\r\n\r\n;; CONTRACTS\r\n(rf/reg-event-fx\r\n :app/load-db-contract\r\n interceptors\r\n (fn [{:keys [db]} [contract-name]]\r\n   (let [{:keys [name address]} (get-in db [:contracts (keyword contract-name)])]\r\n     {:dispatch-chain [[[:contract/load-abi name]\r\n                        [:contract/load-contract address]\r\n                        [:app/contract-instance-loaded name]]]})))\r\n\r\n(rf/reg-event-fx\r\n :app/load-token-abi\r\n interceptors\r\n (fn [_ _]\r\n   {:dispatch-chain [[[:contract/load-abi \"token\"]\r\n                      [:app/token-abi-loaded]]]}))\r\n\r\n(rf/reg-event-fx\r\n :app/deploy-db-contract\r\n interceptors\r\n (fn [{:keys [db]} [contract-name]]\r\n   (let [{:keys [name address]} (get-in db [:contracts (keyword contract-name)])]\r\n     {:dispatch-chain [[[:contract/fetch-compiled-code \"combined\"]\r\n                        [:contract/deploy-compiled-code name address]\r\n                        [:app/contract-instance-loaded name]]]})))\r\n\r\n;; CONTRACT\r\n; Once the instance of the contract is loaded:\r\n(rf/reg-event-fx\r\n :app/contract-instance-loaded\r\n interceptors\r\n (fn [{:keys [db]} [contract-name contract-instance]]\r\n   (println \"Contract instance loaded.\")\r\n   {:db (assoc-in db [:contracts (keyword contract-name) :instance] contract-instance)}))\r\n\r\n;; CONTRACT-FNS\r\n(rf/reg-event-fx\r\n :app/test-rectangle\r\n interceptors\r\n (fn [_ [params]]\r\n   {:dispatch-chain [[[:test-contract-fns/rectangle params]\r\n                      [:app/test-rectangle-resp]]]}))\r\n\r\n(rf/reg-event-db\r\n :app/test-rectangle-resp\r\n interceptors\r\n (fn [db [res]]\r\n   (println \"Transaction Rectangle done:\" res)\r\n   (println (:l (js->clj res)))\r\n   (assoc-in db [:txns :rectangle] res)))\r\n\r\n(rf/reg-event-fx\r\n :app/test-rectangle-estimate\r\n interceptors\r\n (fn [_ [params]]\r\n   {:dispatch-chain [[[:test-contract-fns/estimate-gas-rectangle params]\r\n                      [:app/log]]]}))\r\n\r\n;; SABLIER\r\n(rf/reg-event-fx\r\n :app/sablier-create-stream\r\n interceptors\r\n (fn [_ [params]]\r\n   {:dispatch-chain [[[:sablier/create-stream params]\r\n                      [:app/sablier-stream-created params]]]}))\r\n\r\n(rf/reg-event-db\r\n :app/sablier-stream-created\r\n interceptors\r\n (fn [db [params resp]]\r\n   (update db :streams conj [params resp])))\r\n\r\n\r\n;; FORM\r\n(rf/reg-sub\r\n :form-doc\r\n (fn [db _]\r\n   (:form-doc db)))\r\n\r\n(rf/reg-sub\r\n :form-value\r\n :<- [:form-doc]\r\n (fn [doc [_ path]]\r\n   (get-in doc path)))\r\n\r\n(rf/reg-event-db\r\n :form-set-value\r\n (fn [db [_ path value]]\r\n   (assoc-in db (into [:form-doc] path) value)))\r\n\r\n(rf/reg-event-db\r\n :form-update-value\r\n (fn [db [_ f path value]]\r\n   (update-in db (into [:form-doc] path) f value)))\r\n\r\n(rf/reg-event-db\r\n :app/form-submit-new-recipient\r\n (fn [db]\r\n   (let [address (get-in db [:form-doc :new-recipient-address])]\r\n     (if (= (count address) 42)\r\n       (-> db\r\n           (assoc-in [:recipient-accounts (keyword address) :address] address)\r\n           (assoc-in [:form-doc :selected-recipient-account] address)\r\n           (assoc-in [:form-doc :new-recipient-address] \"\"))\r\n       db))))\r\n\r\n(rf/reg-event-fx\r\n :app/form-submit-create-stream\r\n (fn [{:keys [:db]}]\r\n   (let [{:keys [:selected-user-account\r\n                 :selected-recipient-account\r\n                 :stream-amount\r\n                 :stream-duration]} (:form-doc db)\r\n         now (int (/ (.now js/Date) 1000))\r\n         start-time (+ now 120)\r\n         stop-time (+ now 120 (* 3600 (int stream-duration)))]\r\n     {:db (assoc db :form-doc\r\n                 (dissoc (:form-doc db) :stream-amount :stream-duration))\r\n      :dispatch [:app/sablier-create-stream\r\n                 {:from selected-user-account\r\n                  :to selected-recipient-account\r\n                  :deposit stream-amount\r\n                  :start-time start-time\r\n                  :stop-time stop-time}]})))\r\n\r\n;; UTILS\r\n(rf/reg-event-db\r\n :app/error\r\n (fn [db [_ error]]\r\n   (println \"Global error:\" error)\r\n   (assoc db :global-error error)))\r\n\r\n(rf/reg-event-db\r\n :app/log\r\n (fn [db [_ title value]]\r\n   (println \"Log:\" title \":\" value)\r\n   db))"]}